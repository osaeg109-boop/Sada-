<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sada Ultimate | ØµØ¯Ù‰</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4f46e5;
            --secondary: #818cf8;
            --accent: #f43f5e;
            --bg: #f8fafc;
            --white: #ffffff;
            --text: #1e293b;
            --gray: #64748b;
        }

        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: var(--text); padding-bottom: 80px; overflow-x: hidden; }

        /* Auth System */
        #auth-view { 
            position: fixed; inset: 0; z-index: 5000; 
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            display: flex; align-items: center; justify-content: center; padding: 20px;
        }
        .auth-card { 
            background: white; width: 100%; max-width: 420px; padding: 35px; 
            border-radius: 30px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
        }
        .inp-group { margin-bottom: 12px; text-align: right; }
        .inp-group label { display: block; margin-bottom: 6px; font-weight: 700; color: var(--gray); font-size: 13px; }
        .inp-group input, .inp-group select { 
            width: 100%; padding: 12px; border: 2px solid #f1f5f9; border-radius: 12px; 
            font-size: 15px; transition: 0.3s;
        }
        .inp-group input:focus { border-color: var(--primary); outline: none; }
        .btn-main { 
            width: 100%; padding: 14px; border-radius: 12px; border: none; 
            background: var(--primary); color: white; font-weight: 800; font-size: 16px; 
            cursor: pointer; transition: 0.3s; margin-top: 10px;
        }

        /* Layout */
        header { 
            background: rgba(255,255,255,0.8); backdrop-filter: blur(10px);
            padding: 12px 20px; position: sticky; top: 0; z-index: 1000;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #f1f5f9;
        }
        .view { display: none; padding: 15px; max-width: 600px; margin: 0 auto; animation: fadeIn 0.4s ease; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Stories */
        .story-bar { display: flex; gap: 12px; overflow-x: auto; padding: 10px 0; scrollbar-width: none; }
        .story-node { flex-shrink: 0; text-align: center; width: 70px; cursor: pointer; }
        .story-ring { 
            width: 64px; height: 64px; border-radius: 50%; padding: 3px;
            background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
        }
        .story-ring.seen { background: #e2e8f0; }
        .story-img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; background: white; border: 2px solid white; }

        /* Posts */
        .card { background: white; border-radius: 24px; padding: 16px; margin-bottom: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .user-row { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .pfp-small { width: 44px; height: 44px; border-radius: 50%; object-fit: cover; }
        .post-img { width: 100%; border-radius: 16px; margin-top: 12px; }
        
        /* Actions */
        .actions-row { display: flex; gap: 15px; padding-top: 12px; margin-top: 12px; border-top: 1px solid #f1f5f9; }
        .act-btn { background: none; border: none; display: flex; align-items: center; gap: 5px; cursor: pointer; font-weight: 700; color: var(--gray); }
        .act-btn.liked { color: var(--accent); }

        /* Chat */
        .chat-bubble { max-width: 80%; padding: 12px; border-radius: 18px; margin-bottom: 8px; font-size: 14px; position: relative; }
        .msg-me { align-self: flex-end; background: var(--primary); color: white; border-bottom-right-radius: 4px; }
        .msg-them { align-self: flex-start; background: #f1f5f9; border-bottom-left-radius: 4px; }

        /* Nav */
        nav { 
            position: fixed; bottom: 0; width: 100%; background: white; height: 75px; 
            display: flex; justify-content: space-around; align-items: center;
            border-top: 1px solid #f1f5f9; box-shadow: 0 -10px 15px -3px rgba(0,0,0,0.05);
        }
        .nav-link { display: flex; flex-direction: column; align-items: center; color: #94a3b8; text-decoration: none; font-size: 11px; font-weight: 700; cursor: pointer; }
        .nav-link.active { color: var(--primary); }
        .nav-link i { font-size: 24px; margin-bottom: 4px; }

        .hidden { display: none !important; }
        #image-pre { width: 100px; height: 100px; object-fit: cover; border-radius: 10px; margin-top: 10px; display: none; }
    </style>
</head>
<body>

    <!-- Auth -->
    <div id="auth-view">
        <div class="auth-card">
            <h1 style="text-align:center; color:var(--primary); font-size:40px; margin:0 0 20px 0;">ØµØ¯Ù‰</h1>
            <div id="auth-err" style="color:red; font-size:12px; text-align:center; margin-bottom:10px;"></div>
            
            <div id="reg-only">
                <div class="inp-group">
                    <label>Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</label>
                    <input type="text" id="reg-name" placeholder="Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ">
                </div>
                <div class="inp-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (ÙŠÙˆØ²Ø± Ù†ÙŠÙ…)</label>
                    <input type="text" id="reg-user" placeholder="mo_99">
                </div>
                <div class="inp-group">
                    <label>ØµÙˆØ±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</label>
                    <input type="file" id="reg-pfp" accept="image/*">
                </div>
                <div class="inp-group">
                    <label>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</label>
                    <select id="reg-privacy">
                        <option value="public">Ø­Ø³Ø§Ø¨ Ø¹Ø§Ù… (Ù„Ù„Ø¬Ù…ÙŠØ¹)</option>
                        <option value="private">Ø­Ø³Ø§Ø¨ Ø®Ø§Øµ (Ù…ØªØ§Ø¨Ø¹ÙŠÙ† ÙÙ‚Ø·)</option>
                    </select>
                </div>
            </div>

            <div class="inp-group">
                <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                <input type="email" id="auth-email" placeholder="name@mail.com">
            </div>
            <div class="inp-group">
                <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input type="password" id="auth-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>

            <button class="btn-main" onclick="handleAuth()" id="auth-btn">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
            <p style="text-align:center; font-size:13px; margin-top:15px;">
                <span id="toggle-txt">Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ</span> 
                <a href="#" onclick="toggleAuthMode()" id="toggle-link" style="color:var(--primary); font-weight:900;">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ</a>
            </p>
        </div>
    </div>

    <!-- App Content -->
    <header id="app-header" class="hidden">
        <div style="font-size:24px; font-weight:900; color:var(--primary);">ØµØ¯Ù‰</div>
        <div style="display:flex; gap:15px;">
            <span onclick="navTo('chat')" style="cursor:pointer; font-size:20px;">ğŸ’¬</span>
        </div>
    </header>

    <div id="main-content" class="hidden">
        
        <!-- Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <div id="home-view" class="view active">
            <div class="story-bar" id="story-list">
                <div class="story-node" onclick="document.getElementById('story-inp').click()">
                    <div class="story-ring seen" style="border: 2px dashed #cbd5e1; background:none;">
                        <div style="width:100%; height:100%; border-radius:50%; background:#f1f5f9; display:flex; align-items:center; justify-content:center; font-size:24px;">+</div>
                    </div>
                    <div style="font-size:10px; font-weight:700; margin-top:5px;">Ù‚ØµØªÙƒ</div>
                    <input type="file" id="story-inp" hidden accept="image/*" onchange="uploadStory(this)">
                </div>
            </div>
            <div id="posts-feed"></div>
        </div>

        <!-- Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø© -->
        <div id="search-view" class="view">
            <input type="text" id="search-q" style="width:100%; padding:14px; border-radius:15px; border:1px solid #e2e8f0;" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ØµØ¯Ù‚Ø§Ø¡..." oninput="doSearch()">
            <div id="search-results" style="margin-top:15px;"></div>
        </div>

        <!-- Ø§Ù„Ù†Ø´Ø± -->
        <div id="add-view" class="view">
            <div class="card">
                <h3 style="margin-top:0">Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯</h3>
                <textarea id="post-text" style="width:100%; height:120px; border:none; background:#f8fafc; border-radius:15px; padding:15px; resize:none;" placeholder="Ø§ÙƒØªØ¨ ÙˆØµÙ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ù‡Ù†Ø§..."></textarea>
                <div style="margin:15px 0; border:2px dashed #e2e8f0; padding:20px; border-radius:15px; text-align:center; cursor:pointer;" onclick="document.getElementById('post-img-file').click()">
                    <span>ğŸ“¸ Ø§Ø±ÙÙ‚ ØµÙˆØ±Ø©</span>
                    <input type="file" id="post-img-file" hidden accept="image/*" onchange="previewImg(this)">
                    <img id="image-pre">
                </div>
                <button class="btn-main" onclick="sendPost()">Ù†Ø´Ø± ÙÙŠ ØµØ¯Ù‰</button>
            </div>
        </div>

        <!-- Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø© -->
        <div id="chat-view" class="view">
            <div id="chat-rooms"></div>
            <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø´Ø§Øª -->
            <div id="private-msg" class="hidden" style="position:fixed; inset:0; background:white; z-index:2000; display:flex; flex-direction:column;">
                <div style="padding:15px; border-bottom:1px solid #eee; display:flex; align-items:center; gap:10px;">
                    <button onclick="document.getElementById('private-msg').classList.add('hidden')" style="border:none; background:none; font-size:20px;">â†</button>
                    <img id="chat-target-img" class="pfp-small">
                    <b id="chat-target-name"></b>
                </div>
                <div id="msg-area" style="flex:1; overflow-y:auto; padding:15px; display:flex; flex-direction:column;"></div>
                <div style="padding:15px; border-top:1px solid #eee; display:flex; gap:10px;">
                    <input type="text" id="msg-inp" style="flex:1; padding:10px; border-radius:20px; border:1px solid #eee;" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...">
                    <button onclick="sendMsg()" style="background:var(--primary); color:white; border:none; border-radius:50%; width:40px; height:40px;">â¤</button>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ø­Ø³Ø§Ø¨ -->
        <div id="profile-view" class="view">
            <div class="card" style="text-align:center">
                <img id="my-pfp" class="pfp-small" style="width:100px; height:100px; margin-bottom:15px;">
                <h2 id="my-name" style="margin:0"></h2>
                <p id="my-user" style="color:var(--gray); margin:5px 0"></p>
                <div style="display:flex; justify-content:center; gap:20px; margin:15px 0">
                    <div><b id="count-followers">0</b><br><small>Ù…ØªØ§Ø¨Ø¹</small></div>
                    <div><b id="count-following">0</b><br><small>Ù…ØªØ§Ø¨Ø¹Ø©</small></div>
                </div>
                <button class="btn-main" style="background:var(--accent)" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
            </div>
        </div>

    </div>

    <!-- Nav -->
    <nav id="app-nav" class="hidden">
        <div class="nav-link active" onclick="navTo('home', this)"><i>ğŸ </i><span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></div>
        <div class="nav-link" onclick="navTo('search', this)"><i>ğŸ”</i><span>Ø§ÙƒØªØ´Ù</span></div>
        <div class="nav-link" onclick="navTo('add', this)"><i>â•</i><span>Ù†Ø´Ø±</span></div>
        <div class="nav-link" onclick="navTo('profile', this)"><i>ğŸ‘¤</i><span>Ø­Ø³Ø§Ø¨ÙŠ</span></div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, where, serverTimestamp, doc, getDoc, setDoc, updateDoc, arrayUnion, arrayRemove, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAhg6oTG1EJ44ST1zkkeYvKpfLMD2JDV3M",
            authDomain: "fir-c3e88.firebaseapp.com",
            projectId: "fir-c3e88",
            storageBucket: "fir-c3e88.firebasestorage.app",
            messagingSenderId: "202130175288",
            appId: "1:202130175288:web:0d7ad99c3c828501b4fdcd"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let user = null, userData = null, isReg = true, postImg = null, chatTo = null;

        // --- Auth Functions ---
        window.toggleAuthMode = () => {
            isReg = !isReg;
            document.getElementById('reg-only').classList.toggle('hidden');
            document.getElementById('auth-btn').innerText = isReg ? "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨" : "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„";
            document.getElementById('toggle-txt').innerText = isReg ? "Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ" : "Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ";
            document.getElementById('toggle-link').innerText = isReg ? "Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ" : "Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†";
        };

        const compressImg = (file) => new Promise((res) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = (e) => {
                const img = new Image();
                img.src = e.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const max = 600; 
                    let w = img.width, h = img.height;
                    if(w > h) { if(w > max){ h *= max/w; w = max; } }
                    else { if(h > max){ w *= max/h; h = max; } }
                    canvas.width = w; canvas.height = h;
                    canvas.getContext('2d').drawImage(img, 0, 0, w, h);
                    res(canvas.toDataURL('image/jpeg', 0.7));
                }
            }
        });

        window.handleAuth = async () => {
            const email = document.getElementById('auth-email').value, pass = document.getElementById('auth-pass').value;
            const err = document.getElementById('auth-err');
            try {
                if(isReg) {
                    const name = document.getElementById('reg-name').value, username = document.getElementById('reg-user').value.toLowerCase().trim();
                    const pfpFile = document.getElementById('reg-pfp').files[0];
                    if(!name || !username) throw new Error("Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
                    let pfp = ""; if(pfpFile) pfp = await compressImg(pfpFile);
                    
                    const res = await createUserWithEmailAndPassword(auth, email, pass);
                    await setDoc(doc(db, "users", res.user.uid), {
                        name, username, pfp, uid: res.user.uid, followers: [], following: [], privacy: document.getElementById('reg-privacy').value
                    });
                } else {
                    await signInWithEmailAndPassword(auth, email, pass);
                }
            } catch(e) { err.innerText = e.message; }
        };

        onAuthStateChanged(auth, async (u) => {
            if(u) {
                user = u;
                const snap = await getDoc(doc(db, "users", u.uid));
                userData = snap.data();
                document.getElementById('auth-view').classList.add('hidden');
                document.getElementById('app-header').classList.remove('hidden');
                document.getElementById('main-content').classList.remove('hidden');
                document.getElementById('app-nav').classList.remove('hidden');
                
                document.getElementById('my-name').innerText = userData.name;
                document.getElementById('my-user').innerText = "@" + userData.username;
                document.getElementById('my-pfp').src = userData.pfp || 'https://via.placeholder.com/100';
                document.getElementById('count-followers').innerText = userData.followers?.length || 0;
                document.getElementById('count-following').innerText = userData.following?.length || 0;
                
                loadPosts();
                loadStories();
            }
        });

        window.logout = () => signOut(auth).then(() => location.reload());

        // --- Core Social Functions ---
        window.navTo = (id, el) => {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(id + '-view').classList.add('active');
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            if(el) el.classList.add('active');
        };

        window.previewImg = async (f) => {
            if(f.files[0]) {
                postImg = await compressImg(f.files[0]);
                document.getElementById('image-pre').src = postImg;
                document.getElementById('image-pre').style.display = 'block';
            }
        };

        window.sendPost = async () => {
            const txt = document.getElementById('post-text').value;
            if(!txt && !postImg) return;
            await addDoc(collection(db, "posts"), {
                text: txt, img: postImg || "", author: userData.name, username: userData.username, 
                pfp: userData.pfp || "", uid: user.uid, likes: [], at: serverTimestamp()
            });
            document.getElementById('post-text').value = "";
            document.getElementById('image-pre').style.display = 'none';
            postImg = null;
            navTo('home', document.querySelector('.nav-link'));
        };

        function loadPosts() {
            const q = query(collection(db, "posts"), orderBy("at", "desc"));
            onSnapshot(q, (snap) => {
                const feed = document.getElementById('posts-feed');
                feed.innerHTML = "";
                snap.forEach(d => {
                    const p = d.data();
                    const liked = p.likes?.includes(user.uid);
                    feed.innerHTML += `
                        <div class="card">
                            <div class="user-row">
                                <img src="${p.pfp || 'https://via.placeholder.com/44'}" class="pfp-small">
                                <div><b>${p.author}</b><br><small style="color:var(--gray)">@${p.username}</small></div>
                                ${p.uid !== user.uid ? `<button onclick="followUser('${p.uid}')" style="margin-right:auto; border:none; color:var(--primary); font-weight:900; background:none;">Ù…ØªØ§Ø¨Ø¹Ø©</button>` : ''}
                            </div>
                            <div style="font-size:15px; line-height:1.5">${p.text}</div>
                            ${p.img ? `<img src="${p.img}" class="post-img">` : ''}
                            <div class="actions-row">
                                <button class="act-btn ${liked ? 'liked' : ''}" onclick="likePost('${d.id}', ${liked})">${liked?'â¤ï¸':'ğŸ¤'} ${p.likes?.length || 0}</button>
                                <button class="act-btn" onclick="openChat('${p.uid}', '${p.author}', '${p.pfp}')">ğŸ’¬ Ù…Ø±Ø§Ø³Ù„Ø©</button>
                            </div>
                        </div>
                    `;
                });
            });
        }

        window.likePost = async (id, liked) => {
            await updateDoc(doc(db, "posts", id), { likes: liked ? arrayRemove(user.uid) : arrayUnion(user.uid) });
        };

        window.followUser = async (tid) => {
            await updateDoc(doc(db, "users", user.uid), { following: arrayUnion(tid) });
            await updateDoc(doc(db, "users", tid), { followers: arrayUnion(user.uid) });
            alert("ØªÙ…Øª Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©");
        };

        // --- Stories ---
        window.uploadStory = async (f) => {
            if(f.files[0]) {
                const sImg = await compressImg(f.files[0]);
                await addDoc(collection(db, "stories"), {
                    img: sImg, uid: user.uid, author: userData.name, at: serverTimestamp()
                });
                alert("ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù‚ØµØ©!");
            }
        };

        function loadStories() {
            const q = query(collection(db, "stories"), orderBy("at", "desc"));
            onSnapshot(q, (snap) => {
                const list = document.getElementById('story-list');
                const items = list.querySelectorAll('.story-node:not(:first-child)');
                items.forEach(i => i.remove());
                snap.forEach(d => {
                    const s = d.data();
                    list.innerHTML += `
                        <div class="story-node" onclick="alert('Ù…Ø´Ø§Ù‡Ø¯Ø© Ù‚ØµØ© ${s.author}')">
                            <div class="story-ring"><img src="${s.img}" class="story-img"></div>
                            <div style="font-size:10px; font-weight:700; margin-top:5px;">${s.author}</div>
                        </div>
                    `;
                });
            });
        }

        // --- Chat ---
        window.openChat = (uid, name, pfp) => {
            if(uid === user.uid) return;
            chatTo = { uid, name, pfp };
            document.getElementById('chat-target-name').innerText = name;
            document.getElementById('chat-target-img').src = pfp || 'https://via.placeholder.com/44';
            document.getElementById('private-msg').classList.remove('hidden');
            loadMsgs(uid);
        };

        window.sendMsg = async () => {
            const txt = document.getElementById('msg-inp').value;
            if(!txt.trim()) return;
            const cid = [user.uid, chatTo.uid].sort().join('_');
            await addDoc(collection(db, "messages"), {
                cid, text: txt, from: user.uid, to: chatTo.uid, at: serverTimestamp()
            });
            document.getElementById('msg-inp').value = "";
        };

        function loadMsgs(tid) {
            const cid = [user.uid, tid].sort().join('_');
            const q = query(collection(db, "messages"), where("cid", "==", cid), orderBy("at", "asc"));
            onSnapshot(q, (snap) => {
                const area = document.getElementById('msg-area');
                area.innerHTML = "";
                snap.forEach(d => {
                    const m = d.data();
                    const me = m.from === user.uid;
                    area.innerHTML += `<div class="chat-bubble ${me ? 'msg-me' : 'msg-them'}">${m.text}</div>`;
                });
                area.scrollTop = area.scrollHeight;
            });
        }

        // --- Search ---
        window.doSearch = async () => {
            const q = document.getElementById('search-q').value.toLowerCase();
            const res = document.getElementById('search-results');
            if(!q) { res.innerHTML = ""; return; }
            const snap = await getDocs(collection(db, "users"));
            res.innerHTML = "";
            snap.forEach(d => {
                const u = d.data();
                if(u.username.includes(q) && u.uid !== user.uid) {
                    res.innerHTML += `
                        <div class="card" style="display:flex; align-items:center; gap:15px; cursor:pointer;" onclick="openChat('${u.uid}', '${u.name}', '${u.pfp}')">
                            <img src="${u.pfp || 'https://via.placeholder.com/44'}" class="pfp-small">
                            <div><b>${u.name}</b><br><small>@${u.username}</small></div>
                            <button style="margin-right:auto; border:none; background:var(--primary); color:white; padding:5px 10px; border-radius:8px;">Ù…Ø±Ø§Ø³Ù„Ø©</button>
                        </div>
                    `;
                }
            });
        };

    </script>
</body>
</html>

